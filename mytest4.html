


<html>
<head>
<script src="https://unpkg.com/xrpl@2.0.0/build/xrpl-latest-min.js"></script>
<script>

(function (logger) {
    console.old = console.log;
    console.log = function () {
        var output = "", arg, i;

        for (i = 0; i < arguments.length; i++) {
            arg = arguments[i];
            output += "<span class=\"log-" + (typeof arg) + "\">";

            if (
                typeof arg === "object" &&
                typeof JSON === "object" &&
                typeof JSON.stringify === "function"
            ) {
                output += JSON.stringify(arg);   
            } else {
                output += arg;   
            }

            output += "</span>&nbsp;";
        }

        logger.innerHTML += output + "<br>";
        console.old.apply(undefined, arguments);
    };
})(document.getElementById("logger"));

//***************************
//** Get NFT Faucet *************
//***************************
async function wait_for_seq(network_url, address) {
  const api = new xrpl.Client(network_url)
  await api.connect()
  let response;
  while (true) {
    try {
      response = await api.request({
        command: "account_info",
        account: address,
        ledger_index: "validated"
      })
      break
    } catch(e) {
      await new Promise(resolve => setTimeout(resolve, 1000))
    }
  }
  console.log(response)
  $("#sequence").html('<h3>Sequence Number</h3> '+response.result.account_data.Sequence)
  api.disconnect()
}


function rippleTestNetCredentials(url, altnet_name) {

  const credentials = $('#your-credentials')
  const address = $('#address')
  const secret = $('#secret')
  const balance = $('#balance')
  const sequence = $('#sequence')
  const loader = $('#loader')

  //reset the fields initially and for re-generation
  credentials.hide()
  address.html('')
  secret.html('')
  balance.html('')
  sequence.html('')
  loader.css('display', 'inline')

  
  //call the alt-net and get key generations
  $.ajax({
    url: url,
    type: 'POST',
    dataType: 'json',
    success: function(data) {
      //hide the loader and show results
      loader.hide();
      credentials.hide().html('<h2>Your '+altnet_name+' Credentials</h2>').fadeIn('fast')
      address.hide().html('<h3>Address</h3> ' +
        data.account.address).fadeIn('fast')
      secret.hide().html('<h3>Secret</h3> ' +
        data.account.secret).fadeIn('fast')
      balance.hide().html('<h3>Balance</h3> ' +
        Number(data.balance).toLocaleString('en') + ' XRP').fadeIn('fast')
      sequence.html('<h3>Sequence</h3> <img class="throbber" src="assets/img/xrp-loader-96.png"> Waiting...').fadeIn('fast')
      if (altnet_name=="Testnet") {
        wait_for_seq("wss://s.altnet.rippletest.net:51233", data.account.address)
      } else if (altnet_name=="NFT-Devnet") {
        wait_for_seq("wss://xls20-sandbox.rippletest.net:51233", data.account.address)
      } else {
        wait_for_seq("wss://s.devnet.rippletest.net:51233", data.account.address)
      }

    },
    error: function() {
      loader.hide();
      alert("There was an error with the "+altnet_name+" faucet. Please try again.");
    }
  })
}

$(document).ready(function() {
  function testnet_click(evt) {
    rippleTestNetCredentials("https://faucet.altnet.rippletest.net/accounts",
      "Testnet")
  }
  function devnet_click(evt) {
    rippleTestNetCredentials("https://faucet.devnet.rippletest.net/accounts",
      "Devnet")
  }
  function nftnet_click(evt) {
    rippleTestNetCredentials("https://faucet-nft.ripple.com/accounts",
      "NFT-Devnet")
  }

  $('#testnet-creds-button').click(testnet_click)
  $('#devnet-creds-button').click(devnet_click)
  $('#nftnet-creds-button').click(nftnet_click)
})


</script>
<script>
    // In browsers, use a <script> tag. In Node.js, uncomment the following line:
// const xrpl = require('xrpl')

// Wrap code in an async function so we can use await
async function main() {

// Define the network client
// const client = new xrpl.Client("wss://s.altnet.rippletest.net:51233")
const client = new xrpl.Client("wss://faucet-nft.ripple.com/accounts:51233")

await client.connect()

// ... custom code goes here
// Create a wallet and fund it with the Testnet faucet:
const fund_result = await client.fundWallet()
const test_wallet = fund_result.wallet
console.log(fund_result)


// Get info from the ledger about the address we just funded
const response = await client.request({
    "command": "account_info",
    "account": test_wallet.address,
    "ledger_index": "validated"
  })
console.log(response)

// Disconnect when done (If you omit this, Node.js won't end the process)
client.disconnect()
}

main()


</script>

<script>
    document.getElementById("cmtx_comment").value = localStorage.getItem("comment");
    async function saveComment() {
        var comment = document.getElementById("cmtx_comment").value;
        if (comment == "") {
            alert("Please enter a comment in first!");
            return false;
        }
        var myname2 = '{{ env('MYNAME2') }}';
        localStorage.setItem("comment", comment);
        alert("Your comment has been saved!",myname2);

        var account = document.getElementById("account").value;
        if (account == "") {
            alert("Please enter account in first!");
            return false;
        }

        localStorage.setItem("account", account);
        alert("Your account has been saved!");

        location.reload();
        return false;
        //return true;
    }
</script>
</head>
<script>

    var myname2 = '{{ env('MYNAME2') }}';
    
    alert(myname2);
    
</script>
<form method="post" action="" onSubmit="return main();">
    <tr>
    <input type="text" name="cmtx_comment" id="cmtx_comment" value="" />
    </tr>
    <tr>
    <input type="text" name="account" id="account" value="" />
    </tr>form>
    <input type="submit" value="Save" />
    <script>

        var myname = '{{ env('MYNAME') }}';
        
        alert(myname);
        
    </script>
</form>
</html>